@page
@model GestorComercialCredito.Web.Pages.TestConnectionModel
@using System.Linq

@{
    ViewData["Title"] = "Prueba de Conexión";
    var databaseInfo = Model?.DatabaseInfo ?? Enumerable.Empty<string>();
    var connectionString = Model?.ConnectionString ?? "No configurada";
    var testResult = Model?.TestResult;
    var errorMessage = Model?.ErrorMessage;
}

<div class="container mt-4">
    <h2>Prueba de Conexión a Base de Datos</h2>
    <hr />

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Información de Conexión</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Cadena de Conexión:</strong>
                        <div class="alert alert-info mt-2">
                            <code>@connectionString</code>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(testResult))
                    {
                        <div class="mb-3">
                            <strong>Resultado:</strong>
                            <div class="alert @(testResult.Contains("✓") ? "alert-success" : "alert-danger") mt-2">
                                @testResult
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(errorMessage))
                    {
                        <div class="mb-3">
                            <strong>Error:</strong>
                            <div class="alert alert-danger mt-2">
                                @errorMessage
                            </div>
                        </div>
                    }

                    @if (databaseInfo.Any())
                    {
                        <div class="mb-3">
                            <strong>Información de la Base de Datos:</strong>
                            <ul class="list-group mt-2">
                                @foreach (var info in databaseInfo)
                                {
                                    <li class="list-group-item">@info</li>
                                }
                            </ul>
                        </div>
                    }
                </div>
            </div>

            <div class="mt-4">
                <h5>Posibles Soluciones:</h5>
                <ul>
                    <li>Verifica que SQL Server esté ejecutándose</li>
                    <li>Verifica que la base de datos 'GestorComercialCredito' exista</li>
                    <li>Si usas una instancia con nombre (ej: SQLEXPRESS), cambia "Server=." por "Server=.\SQLEXPRESS"</li>
                    <li>Verifica que tu usuario de Windows tenga permisos en la base de datos</li>
                    <li>Ejecuta el script database-schema.sql para crear las tablas</li>
                </ul>
            </div>

            <div class="mt-3">
                <a asp-page="/Index" class="btn btn-primary">Volver al Inicio</a>
            </div>
        </div>
    </div>
</div>
